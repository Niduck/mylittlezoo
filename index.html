<!doctype html>
<html lang="fr">
<head>
    <meta charset="utf-8">
    <!-- HTML Meta Tags -->
    <title>My little zoo</title>
    <meta name="description" content="Faire découvrir les animaux et leurs cris aux petits et aux plus grands.">
    <!-- Manifest -->
    <link rel="manifest" href="manifest.json">
    <!-- Facebook Meta Tags -->
    <meta property="og:url" content="https://mylittlezoo.app/">
    <meta property="og:type" content="website">
    <meta property="og:title" content="My little zoo">
    <meta property="og:description" content="Faire découvrir les animaux et leurs cris aux petits et aux plus grands.">
    <meta property="og:image" content="https://mylittlezoo.app/assets/images/icons/cover.png">
    <!-- Twitter Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta property="twitter:domain" content="mylittlezoo.app">
    <meta property="twitter:url" content="https://mylittlezoo.app/">
    <meta name="twitter:title" content="My little zoo">
    <meta name="twitter:description" content="Faire découvrir les animaux et leurs cris aux petits et aux plus grands.">
    <meta name="twitter:image" content="https://mylittlezoo.app/assets/images/icons/cover.png">
    <!--Icons-->
    <link rel="shortcut icon" href="assets/images/icons/favicon.ico" type="image/x-icon"/>
    <link rel="apple-touch-icon" href="assets/images/icons/apple-touch-icon.png"/>
    <link rel="apple-touch-icon" sizes="57x57" href="assets/images/icons/apple-touch-icon-57x57.png"/>
    <link rel="apple-touch-icon" sizes="72x72" href="assets/images/icons/apple-touch-icon-72x72.png"/>
    <link rel="apple-touch-icon" sizes="76x76" href="assets/images/icons/apple-touch-icon-76x76.png"/>
    <link rel="apple-touch-icon" sizes="114x114" href="assets/images/icons/apple-touch-icon-114x114.png"/>
    <link rel="apple-touch-icon" sizes="120x120" href="assets/images/icons/apple-touch-icon-120x120.png"/>
    <link rel="apple-touch-icon" sizes="144x144" href="assets/images/icons/apple-touch-icon-144x144.png"/>
    <link rel="apple-touch-icon" sizes="152x152" href="assets/images/icons/apple-touch-icon-152x152.png"/>
    <link rel="apple-touch-icon" sizes="180x180" href="assets/images/icons/apple-touch-icon-180x180.png"/>
    <!-- Style and js-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="assets/scss/main.css" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;600&family=Sacramento&display=swap" rel="stylesheet">
    <script src="assets/resources/zoo.js"></script>
</head>
<body>
<header>
    <div class="title">My little zoo</div>
</header>
<main>
    <div class="left">
            <div id="animal-title"></div>
            <div id="animal-description"></div>
            <div id="animal-facts"></div>
    </div>
    <div class="right">
        <div class="animal-image-container">
            <img id="animal-image">
        </div>
    </div>
</main>
<footer>

</footer>
<script>
    let index = 0;
    let first = true;
    render(index)
    let audio = new Audio();
    function render (_index) {
        if(_index > zoo.length -1){
            index = 0
            _index = index
        }
        if(_index < 0){
            index = zoo.length -1
            _index = index
        }
        document.body.classList.toggle('animal-changing')
        document.body.style.backgroundColor = zoo[_index].colors.background;
        let image = document.getElementById("animal-image");
        let title = document.getElementById("animal-title");
        let desc = document.getElementById("animal-description");
        let facts = document.getElementById("animal-facts");
        facts.innerHTML = "";
        setTimeout(function () {
            document.body.style.setProperty('--accent-color', zoo[_index].colors.accent);
            document.body.classList.remove('animal-changing')
            image.src = zoo[_index].path;
            title.innerText = zoo[_index].title
            desc.innerHTML = zoo[_index].description
            for(let fact of zoo[_index].facts){
                let p = document.createElement("p")
                    p.append(fact)
                facts.append(p);
            }
            let sel = document.querySelectorAll('[data-sound]');
            sel.forEach(node => {
                node.addEventListener('click', e => {
                    let soundName = e.target.getAttribute('data-sound');
                    playAudio(zoo[_index].sounds[soundName]);
                })
            })
            first= false
        }, first ? 0 : 750)
    }
    function playAudio (src) {
        audio.src = src;
        return new Promise(function (resolve, reject) {
            audio.addEventListener('loadedmetadata', function () {
                audio.volume = 1;
                audio.play();
                setTimeout(function () {
                    resolve(audio);
                }, audio.duration * 1000)
            });
        });
    }
    function debounce (func, wait, immediate) {
        var timeout;
        return function () {
            var context = this, args = arguments;
            var later = function () {
                timeout = null;
                if (!immediate) func.apply(context, args);
            };
            var callNow = immediate && !timeout;
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
            if (callNow) func.apply(context, args);
        };
    };
    //*** Event listeners
    window.addEventListener('keyup', function (e) {
        if (e.keyCode === 39) {
            index ++;
            render(index)
        }
        if (e.keyCode === 37) {
            index --;
            render(index)
        }
    })
    let onSwipeLeft = function (e) {
        index++;
        render(index)

    }
    let onSwipeRight = function (e) {
        index--;
        render(index)
    }
    let onSwipeDown = function (e) {
        let body = document.body;
        if (!body.classList.contains('fullscreen')) {
            body.classList.add('fullscreen')
        }
    }
    let onSwipeUp = function (e) {
        let body = document.body;
        if (body.classList.contains('fullscreen')) {
            body.classList.remove('fullscreen')
        }
    }
    //? @source : https://stackoverflow.com/questions/2264072/detect-a-finger-swipe-through-javascript-on-the-iphone-and-android
    let right = document.body;
    right.addEventListener('touchstart', handleTouchStart, false);
    right.addEventListener('touchmove', handleTouchMove, false);
    var xDown = null;
    var yDown = null;

    function handleTouchStart (evt) {
        const firstTouch = evt.touches[0];
        xDown = firstTouch.clientX;
        yDown = firstTouch.clientY;
    }

    function handleTouchMove (evt) {
        if (!xDown || !yDown) {
            return;
        }

        var xUp = evt.touches[0].clientX;
        var yUp = evt.touches[0].clientY;

        var xDiff = xDown - xUp;
        var yDiff = yDown - yUp;

        if (Math.abs(xDiff) > Math.abs(yDiff)) {/*most significant*/
            if (xDiff > 0) {
                debounce(function () {
                    onSwipeLeft(evt);
                }, 500)()
            } else {
                debounce(function () {
                    onSwipeRight(evt)
                }, 500)()
            }
        } else {
            if (yDiff > 0) {
                // debounce(function () {
                // onSwipeUp(evt)
                // }, 500)()
            } else {
                // debounce(function () {
                // onSwipeDown(evt)
                // }, 500)()
                /* down swipe */
            }
        }
        /* reset values */
        xDown = null;
        yDown = null;
    }
</script>
</body>
</html>
